<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/Android-Utils/blog/rss.xml" title="Android Utils Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Android-Utils/blog/atom.xml" title="Android Utils Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Android Utils" href="/Android-Utils/opensearch.xml"><title data-react-helmet="true">Premium App | Android Utils</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Premium App | Android Utils"><meta data-react-helmet="true" name="description" content="Description"><meta data-react-helmet="true" property="og:description" content="Description"><meta data-react-helmet="true" property="og:url" content="https://jeovanimartinez.github.io/Android-Utils//Android-Utils/docs/library-utilities/premium-app"><link data-react-helmet="true" rel="shortcut icon" href="/Android-Utils/img/site/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link data-react-helmet="true" rel="canonical" href="https://jeovanimartinez.github.io/Android-Utils//Android-Utils/docs/library-utilities/premium-app"><link rel="stylesheet" href="/Android-Utils/styles.87b61235.css">
<link rel="preload" href="/Android-Utils/styles.19ccabb2.js" as="script">
<link rel="preload" href="/Android-Utils/runtime~main.aa61b22a.js" as="script">
<link rel="preload" href="/Android-Utils/main.4a2a3308.js" as="script">
<link rel="preload" href="/Android-Utils/1.695e1eda.js" as="script">
<link rel="preload" href="/Android-Utils/26.48ea0ef5.js" as="script">
<link rel="preload" href="/Android-Utils/29.b7166ec2.js" as="script">
<link rel="preload" href="/Android-Utils/f976f453.d58d2dd9.js" as="script">
<link rel="preload" href="/Android-Utils/25.59617270.js" as="script">
<link rel="preload" href="/Android-Utils/52b2a23a.a7621785.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/Android-Utils/"><img src="/Android-Utils/img/site/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/Android-Utils/img/site/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Android Utils</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Android-Utils/docs/">Docs</a><a target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" href="/Android-Utils/docs/reference/androidutils/index.html">API Reference</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/JeovaniMartinez/Android-Utils" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/Android-Utils/"><img src="/Android-Utils/img/site/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/Android-Utils/img/site/logo.svg" alt="My Site Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">Android Utils</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/Android-Utils/docs/">Docs</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link" href="/Android-Utils/docs/reference/androidutils/index.html">API Reference</a></li><li class="menu__list-item"><a href="https://github.com/JeovaniMartinez/Android-Utils" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Android Utils</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Android-Utils/docs/android-utils/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Android-Utils/docs/android-utils/motivation">Motivation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Android-Utils/docs/">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Android-Utils/docs/configuration/log">Log</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Android-Utils/docs/configuration/firebase-analytics">Firebase Analytics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Android-Utils/docs/configuration/firebase-crashlytics">Firebase Crashlytics</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Annotations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Android-Utils/docs/annotations/code-inspection-annotations">Code Inspection Annotations</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Library Utilities</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Android-Utils/docs/library-utilities/rate-app">Rate App</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Android-Utils/docs/library-utilities/watermark">Watermark</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Android-Utils/docs/library-utilities/view-to-image">View To Image</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Android-Utils/docs/library-utilities/about-app">About App</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Android-Utils/docs/library-utilities/translucent-theme">Translucent Theme</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/Android-Utils/docs/library-utilities/premium-app">Premium App</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Android-Utils/docs/library-utilities/file-utils">File Utils</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Android-Utils/docs/library-utilities/more-apps">More Apps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Android-Utils/docs/library-utilities/system-web-browser">System Web Browser</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/Android-Utils/docs/library-utilities/extension-functions">Extension Functions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Release Notes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Android-Utils/docs/release-notes/v0.9.0-beta">v0.9.0-beta</a></li></ul></li></ul></div><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_2WRA"><svg width="20" height="20" role="img" class="collapseSidebarButtonIcon_CoMu"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Premium App</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="description"></a>Description<a class="hash-link" href="#description" title="Direct link to heading">#</a></h2><p>Set of utilities to simplify the verification and purchase process of the premium version of the app.</p><p>It provides an abstraction layer to interact with the <a href="https://developer.android.com/google/play/billing" target="_blank" rel="noopener noreferrer">Google Play Billing Library,</a> simplifying
the process and allowing a quick and easy integration
into any app.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="use-cases"></a>Use cases<a class="hash-link" href="#use-cases" title="Direct link to heading">#</a></h3><p>On many occasions, when we develop an app we integrate ads or premium functions. A common practice is to create a free app on Google Ply, which
implements the ads and has certain restrictions, and another paid app without ads and with Premium features. This usually has some drawbacks, and the
best practice is to create only a free app, which shows ads and restricts certain functions, and then, through a purchase, remove these ads and
restrictions, which allows us to have only one app that is easier to manage and update. That is where this library utility comes into play, allowing
such an implementation to be carried out easily and with few code lines.</p><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="security"></a>Security<a class="hash-link" href="#security" title="Direct link to heading">#</a></h3><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>Before implementing this utility in your app, please read the entire documentation to determine if it is the right option for your needs.</p></div></div><p>As your app grows in popularity, it can also attract the unwanted attention of malicious users that might want to abuse your app. In this case, we are
going to focus on analyzing the security of the implementation of this library utility.</p><p>If you publish a free app with ads and limited features and, and a paid app with no ads and features unlocked, a malicious user can easily generate
an apk of your premium app and distribute it. But if you only have one app, and the premium features are limited by an in-app purchase (how this utility
does it), a malicious user must use reverse engineer in your app in order to remove the restrictions, although this may be easy for hackers, it provides
a little more complexity than the previous example.</p><p>Based on the above, if you only need to remove the ads from your app or unlock some features through in-app purchase, this utility may be the right
one for you. If, on the other hand, you need a more rigorous verification of the purchases in your app, you must carry out your own implementation by
performing the validations in your back end. You can read more information about security <a href="https://developer.android.com/google/play/billing/security" target="_blank" rel="noopener noreferrer">here.</a></p><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="getting-ready"></a>Getting Ready<a class="hash-link" href="#getting-ready" title="Direct link to heading">#</a></h2><p>Before we start, we need to prepare a few things to be able to use this library utility.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Before starting, is recommend you take a look at the <a href="https://developer.android.com/google/play/billing" target="_blank" rel="noopener noreferrer">official documentation of Google Play&#x27;s billing system,</a>
so that you can understand how it works and know the terminology.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="1-license-testing"></a>1. License Testing<a class="hash-link" href="#1-license-testing" title="Direct link to heading">#</a></h3><p>In order to test the implementation in your app, you must have at least one license for testing,
<a href="https://support.google.com/googleplay/android-developer/answer/6062777" target="_blank" rel="noopener noreferrer">here</a> you will find information and the steps to create them.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="2-setup-the-project"></a>2. Setup The Project<a class="hash-link" href="#2-setup-the-project" title="Direct link to heading">#</a></h3><p>2.1.- Add the Google Play Billing Library implementation in Gradle file at app level.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>It is strongly recommended to add the indicated version <code>(3.0.3)</code>, to avoid conflicts with dependencies.</p></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-gradle codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">dependencies {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    implementation &#x27;com.android.billingclient:billing-ktx:3.0.3&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>2.2.- In the <code>AndroidManifest</code>, add billing permission.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-xml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">uses-permission</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name namespace" style="color:rgb(178, 204, 214)">android:</span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">com.android.vending.BILLING</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="3-publish-the-app"></a>3. Publish The App<a class="hash-link" href="#3-publish-the-app" title="Direct link to heading">#</a></h3><p>Once you have the project configured, you must generate an apk or bundle of it and publish it on Google Play in any track, including the internal test track.
<em>This is necessary to be able to create the products integrated in the Google Play Console, since when uploading the app with the indicated configuring,
the billing functions are enabled.</em></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="4-create-in-app-product"></a>4. Create In-app Product<a class="hash-link" href="#4-create-in-app-product" title="Direct link to heading">#</a></h3><p>Now it is necessary to create one or more products in the Google Play console that grant premium access to the app, this can be done by following
<a href="https://support.google.com/googleplay/android-developer/answer/1153481?hl#zippy=%2Ccreate-a-single-managed-product" target="_blank" rel="noopener noreferrer">these steps.</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="considerations"></a>Considerations<a class="hash-link" href="#considerations" title="Direct link to heading">#</a></h4><ul><li>The id of the created product we will call <code>sku</code>, since this is how it handles it the Google Play billing library.</li><li>The product must have the <code>active</code> state to be able to handle it in the app.</li></ul><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="components"></a>Components<a class="hash-link" href="#components" title="Direct link to heading">#</a></h2><p>The utility is made up of the following components:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="premiumstate"></a>Premium.State<a class="hash-link" href="#premiumstate" title="Direct link to heading">#</a></h3><blockquote><p>Enum defining the possible states when checking if a user has premium privileges in the app.</p><a target="_blank" href="/Android-Utils/docs/reference/androidutils/com.jeovanimartinez.androidutils.billing.premium/-premium/-state/index.html"><b>[ Reference ]</b></a></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="premiumlistener"></a>Premium.Listener<a class="hash-link" href="#premiumlistener" title="Direct link to heading">#</a></h3><blockquote><p>Listener for events relating to app premium billing.</p><a target="_blank" href="/Android-Utils/docs/reference/androidutils/com.jeovanimartinez.androidutils.billing.premium/-premium/-listener/index.html"><b>[ Reference ]</b></a></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="premiumcontroller"></a>Premium.Controller<a class="hash-link" href="#premiumcontroller" title="Direct link to heading">#</a></h3><blockquote><p>Controller for the purchase and verification process of the premium version of the app.</p><a target="_blank" href="/Android-Utils/docs/reference/androidutils/com.jeovanimartinez.androidutils.billing.premium/-premium/-controller/index.html"><b>[ Reference ]</b></a></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="premiumgetcurrentstate"></a>Premium.getCurrentState()<a class="hash-link" href="#premiumgetcurrentstate" title="Direct link to heading">#</a></h3><blockquote><p>Function that returns the current premium state. It value must be used in all conditions within the app where it is necessary to verify the premium state.</p><a target="_blank" href="/Android-Utils/docs/reference/androidutils/com.jeovanimartinez.androidutils.billing.premium/-premium/get-current-state.html"><b>[ Reference ]</b></a></blockquote><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="implementation"></a>Implementation<a class="hash-link" href="#implementation" title="Direct link to heading">#</a></h2><p>Since we have all the above steps covered, we can now implement the utility as shown below.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>The library provides a detailed flow In the logcat, that you can consult to see a detailed flow of what is being done.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="general"></a>General<a class="hash-link" href="#general" title="Direct link to heading">#</a></h3><p>General implementation.</p><p>1.- In the <code>onCreate()</code> of the singleton or main activity, the utility should be initialized.</p><blockquote><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="configuration-parameters"></a><a target="_blank" href="/Android-Utils/docs/reference/androidutils/com.jeovanimartinez.androidutils.billing.premium/-premium/-controller/init.html"><b>[ Configuration Parameters ]</b></a><a class="hash-link" href="#configuration-parameters" title="Direct link to heading">#</a></h4></blockquote><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-kotlin codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Premium.Controller.init(context, listOf(&quot;premium_upgrade&quot;))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>2.- Later we must set the listener in the place where we want to receive the events related to the app premium billing.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-kotlin codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">val listener = object : Premium.Listener {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    override fun onCheckPremium(state: Premium.State) {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    override fun onPurchaseResult(result: Premium.State) {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    override fun onSkuDetails(skuDetails: List&lt;SkuDetails&gt;?) {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    override fun onStartPurchaseError(code: Int) {}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">Premium.Controller.setListener(listener)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>You can have several listeners in different places, just remember to set and remove them where required.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-kotlin codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Premium.Controller.setListener(listener) // To set the listener</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Premium.Controller.removeListener() // To remove the listener</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="verification"></a>Verification<a class="hash-link" href="#verification" title="Direct link to heading">#</a></h3><p>We must verify whether the user has premium privileges at least on the following occasions.</p><p>1.- On launch main activity, we must do a quick check of the current state, to know if the user is premium or not, and show the appropriate
content, for example:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-kotlin codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">if (Premium.getCurrentState() == Premium.State.PREMIUM) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Code to execute if the user is premium, for example, hide ads</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">} else {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Code to execute if the user is not premium, for example, show ads</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>2.- The previous verification, aims to show the appropriate content at the launch the app, now we must do a direct verification with the billing client,
to update the premium state, this can be done as follows:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-kotlin codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Premium.Controller.checkPremium(context)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The verification is executed asynchronously, and the result is reported by the listener.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-kotlin codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">override fun onCheckPremium(state: Premium.State) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (state == Premium.State.PREMIUM) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // Code to execute if the user is premium, for example, hide ads</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    } else {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // Code to execute if the user is not premium, for example, show ads</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="product-details"></a>Product Details<a class="hash-link" href="#product-details" title="Direct link to heading">#</a></h3><p>This process is optional, and it will help us to show details of the product that provides the premium benefits (name, description, price in the
user&#x27;s currency, etc.).</p><p>The request is performed as follows:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-kotlin codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Premium.Controller.getSkuDetails(context, listOf(&quot;premium_upgrade&quot;))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>And the result is reported by the listener.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-kotlin codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">override fun onSkuDetails(skuDetails: List&lt;SkuDetails&gt;?) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (skuDetails != null) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // Show product details</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    } else {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // Show error message</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="start-purchase"></a>Start Purchase<a class="hash-link" href="#start-purchase" title="Direct link to heading">#</a></h3><p>The purchase of the product is performed as follows.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Before starting the purchase, check the current premium state, and start the purchase only if the user is not premium. For example:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-kotlin codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">when (Premium.getCurrentState()) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Premium.State.NOT_PREMIUM -&gt; Premium.Controller.startPurchase(activity, &quot;premium_upgrade&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Premium.State.PENDING_TRANSACTION -&gt; longToast(&quot;The purchase is pending...&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Premium.State.PREMIUM -&gt; longToast(&quot;You are already a premium user...&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></div><p>To start the purchase:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-kotlin codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Premium.Controller.startPurchase(activity, &quot;premium_upgrade&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In case of an error, it is reported by the listener.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-kotlin codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">override fun onStartPurchaseError(code: Int) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    longToast(&quot;Service unavailable, please try again later&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>If the purchase flow was shown successfully, the result (the purchase was completed, its canceled, its pending, etc.) is reported through the listener.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-kotlin codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">override fun onPurchaseResult(result: Premium.State) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (result == Premium.State.PREMIUM) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // Code to execute if the user is premium, for example, hide ads</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    } else {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // Code to execute if the user is not premium, for example, show ads</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // This is a good place to indicate to the user the result of the purchase</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    when (result) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Premium.State.NOT_PREMIUM -&gt; longToast(&quot;Purchase canceled&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Premium.State.PENDING_TRANSACTION -&gt; longToast(&quot;Thanks, the purchase is pending...&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Premium.State.PREMIUM -&gt; longToast(&quot;Thank you for purchasing the premium version...&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If the purchase was made through a deferred payment, the listener function is invoked at the end of the flow, with the result <code>State.PENDING_TRANSACTION</code>,
and it is invoked again when the transaction is completed, with the new result <code>State.NOT_PREMIUM</code> or <code>State.PREMIUM</code>.</p></div></div><hr><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="considerations-1"></a>Considerations<a class="hash-link" href="#considerations-1" title="Direct link to heading">#</a></h3><p>It is recommended to check the premium state in the <code>onResume()</code> of the main activity, and if the state is <code>State.PENDING_TRANSACTION</code>, check
the state again with the billing client, this in case the listener did not inform when the state of the pending transaction was updated.</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-kotlin codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">if (Premium.getCurrentState() == Premium.State.PENDING_TRANSACTION) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Premium.Controller.checkPremium(context)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><hr><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="testing"></a>Testing<a class="hash-link" href="#testing" title="Direct link to heading">#</a></h2><p>It is recommended to perform out the following list of tests after implementing the utility, to verify that everything works correctly.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><ul><li>To perform multiple test purchases for the same product, you can <a href="https://support.google.com/googleplay/android-developer/answer/2741495" target="_blank" rel="noopener noreferrer">refund and revoke purchases using Google Play console.</a></li><li>To force the state of a purchase to be updated (for example, after a refund), go to the details of the Google Play and clear the data.</li><li>To simulate the billing client disconnection, go to the details of the Google Play and force app stop.</li></ul></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><ul><li>In some tests carried out, when using <strong><em>[ Slow test card, approves after a few minutes ]</em></strong>, the rejection confirmation was not received, so in
this case, after about 5 minutes of having carried out the test, it is necessary to clear the data from the google play app for it to be updated the state.</li><li>When using any <strong><em>[ Approves card ]</em></strong>, when test the purchase, the purchase must be acknowledge, the utility does the process automatically, but the app must be open or it must be opened after about 2 minutes of making the purchase. If this is not done, the purchase is likely to go to refunded status.</li></ul></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="test-list"></a>Test List<a class="hash-link" href="#test-list" title="Direct link to heading">#</a></h3><table><thead><tr><th></th><th>Description</th></tr></thead><tbody><tr><td>1</td><td>Try on a device that does not have Google Play (such as an emulator), the purchase flow should not start and a message or dialog should be displayed  to indicate to the user that the service is not available.</td></tr><tr><td>2</td><td>Start the purchase flow and complete with <strong><em>[ Test card, always declines ]</em></strong>, a message must be displayed in the flow, and when returning to the app nothing should happen, the user must not be premium. <br> The status of the order in the Google Play console of  must be <em>Payment declined</em>.</td></tr><tr><td>3</td><td>Start the purchase flow, and complete with <strong><em>[ Slow test card, declines after a few minutes ]</em></strong>, the purchase flow is finalized and you can show a message to indicate the purchase state. Premium rights should not be granted yet, if the user wants to buy the premium version, they must be told that the payment confirmation is waiting. During the wait, do not close the app, and wait for the rejection confirmation to be received, so the buy button is re-enabled. The rejection confirmation will be received in approximately 1-2 minutes. <br> The status in the Google Play console of the order must go through <em>Payment pending</em> &gt; <em>Payment declined</em>.</td></tr><tr><td>4</td><td>Start the purchase flow, and complete with <strong><em>[ Slow test card, declines after a few minutes ]</em></strong>, the purchase flow is finalized and you can show a message to indicate the purchase state. Premium rights should not be granted yet, later, close the app, wait about 2-3 minutes and open the app again, as the purchase was rejected, the option to buy again should appear and the user should not be premium. <br> The status in the Google Play console of the order must go through <em>Payment pending</em> &gt; <em>Payment declined</em>.</td></tr><tr><td>5</td><td>Start the purchase flow and complete with <strong><em>[ Test card, always approves ]</em></strong>, at the end of the purchase flow, a thanks message should be displayed, and from that moment the user is premium. Wait a moment and close the app and wait about 8 minutes, open the app again and the user must remain premium. <br> The status in the Google Play console of the order must go through <em>Chargeable</em> &gt; <em>Charged</em>.</td></tr><tr><td>6</td><td>Start the purchase flow and complete with <strong><em>[ Slow test card, approves after a few minutes ]</em></strong>, the purchase flow is finished and you can show a message to indicate the purchase state. Premium rights should not be granted yet, if the user wants to buy the premium version again, they must be told that the payment confirmation is waiting. During the wait, do not close the app, and wait for the approval confirmation to be received, at that moment a thanks message is displayed, and the premium functions are enabled (The approval confirmation will be received in approximately 1-2 minutes.). After, close the app and wait about 8 minutes, open the app again and the user must remain premium. <br> The status in the Google Play console of the order must go through <em>Payment pending</em> &gt; <em>Chargeable</em> &gt; <em>Charged</em>.</td></tr><tr><td>7</td><td>Start the purchase flow and complete with <strong><em>[ Slow test card, approves after a few minutes ]</em></strong>, the purchase flow is finished and you can show a message to indicate the purchase state. Premium rights should not be granted yet, later, close the app, wait about 2 minutes and open it the app again, and the user should already be premium. <br> The status in the Google Play console of the order must go through <em>Payment pending</em> &gt; <em>Chargeable</em> &gt; <em>Charged</em>. <br> <em>If you do not open the app within 3 minutes after making the purchase, it will not be acknowledged and a refund will be made.</em></td></tr><tr><td>8</td><td>If you have an older version of the app, make sure that the user is not premium, then update the app, as the user was not premium, it must remain a non-premium user.</td></tr><tr><td>9</td><td>If you have an older version of the app, buy the premium product in that previous version, update the app to the new version and make sure that the purchase and premium benefits are preserved.</td></tr><tr><td>10</td><td>If you have an older version of the app, and the integrated product offering the premium benefits (sku) has changed in the new version, make sure that users who purchased previous integrated products keep the premium benefits.</td></tr></tbody></table></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/JeovaniMartinez/Android-Utils/edit/documentation/docs/library-utilities/premium-app.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Android-Utils/docs/library-utilities/translucent-theme"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Translucent Theme</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/Android-Utils/docs/library-utilities/file-utils"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">File Utils Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#description" class="table-of-contents__link">Description</a><ul><li><a href="#use-cases" class="table-of-contents__link">Use cases</a></li><li><a href="#security" class="table-of-contents__link">Security</a></li></ul></li><li><a href="#getting-ready" class="table-of-contents__link">Getting Ready</a><ul><li><a href="#1-license-testing" class="table-of-contents__link">1. License Testing</a></li><li><a href="#2-setup-the-project" class="table-of-contents__link">2. Setup The Project</a></li><li><a href="#3-publish-the-app" class="table-of-contents__link">3. Publish The App</a></li><li><a href="#4-create-in-app-product" class="table-of-contents__link">4. Create In-app Product</a></li></ul></li><li><a href="#components" class="table-of-contents__link">Components</a><ul><li><a href="#premiumstate" class="table-of-contents__link">Premium.State</a></li><li><a href="#premiumlistener" class="table-of-contents__link">Premium.Listener</a></li><li><a href="#premiumcontroller" class="table-of-contents__link">Premium.Controller</a></li><li><a href="#premiumgetcurrentstate" class="table-of-contents__link">Premium.getCurrentState()</a></li></ul></li><li><a href="#implementation" class="table-of-contents__link">Implementation</a><ul><li><a href="#general" class="table-of-contents__link">General</a></li><li><a href="#verification" class="table-of-contents__link">Verification</a></li><li><a href="#product-details" class="table-of-contents__link">Product Details</a></li><li><a href="#start-purchase" class="table-of-contents__link">Start Purchase</a></li><li><a href="#considerations-1" class="table-of-contents__link">Considerations</a></li></ul></li><li><a href="#testing" class="table-of-contents__link">Testing</a><ul><li><a href="#test-list" class="table-of-contents__link">Test List</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Jeovani Martinez. Built with Docusaurus.</div></div></div></footer></div>
<script src="/Android-Utils/styles.19ccabb2.js"></script>
<script src="/Android-Utils/runtime~main.aa61b22a.js"></script>
<script src="/Android-Utils/main.4a2a3308.js"></script>
<script src="/Android-Utils/1.695e1eda.js"></script>
<script src="/Android-Utils/26.48ea0ef5.js"></script>
<script src="/Android-Utils/29.b7166ec2.js"></script>
<script src="/Android-Utils/f976f453.d58d2dd9.js"></script>
<script src="/Android-Utils/25.59617270.js"></script>
<script src="/Android-Utils/52b2a23a.a7621785.js"></script>
</body>
</html>